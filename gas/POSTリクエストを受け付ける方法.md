# POSTリクエストを受け付ける方法

## POSTリクエストを受け付ける関数

Google Apps Script では、 `doPost` 関数にてPOSTリクエストを受け付けられます。

```js
/**
 * POSTリクエストを受け付け、リクエスト内容をスプレッドシートに追記します
 *
 * @param {Hash} POSTリクエスト
 */
function doPost(e) {
  var ss = SpreadsheetApp.getActiveSpreadsheet();
  var sheet = ss.getActiveSheet();
  sheet.appendRow([JSON.stringify(e)]);
}
```

動作確認の簡単化のため、

スプレッドシートに紐付くスクリプト(Container Bound Script)で作成していますが、

単体のスクリプト(Standalone Script)でも問題ありません。

## アプリケーションを公開する

関数を作成しただけでは、まだリクエストは受取れません。

（リクエストする側も、どこにリクエストを投げれば良いかわからないはずです）

ということで、アプリケーションを公開して、URLを取得します。

以下、手順

1. スクリプト編集画面を開く

1. [公開]-[ウェブアプリケーションとして導入] をクリック

1. 以下内容を入力して `導入` ボタンをクリック

    |項目                                    |値                        |
    |----------------------------------------|--------------------------|
    |プロジェクトバージョン                  |新規作成                  |
    |変更の説明                              |任意の内容                |
    |次のユーザーとしてアプリケーションを実行|自分                      |
    |アプリケーションにアクセスできるユーザー|全員（匿名ユーザーを含む）|

1. `現在のウェブアプリケーションのURL` の表示内容を控えておく

    ※リクエスト先のURLです

## リクエストを投げてみる

今回の例では、リクエストを投げるたび、

スプレッドシートにリクエスト内容が追加されることが確認できます。

該当のURLにPOSTリクエストを投げられれば何でも良いですが、

curlコマンドだと以下のようになります。

`$ curl -X POST <application_url> -d 'key=val'`

## 応用例

SlackのOutgoingWebhooks/IncomingWebhooksと組み合わせると、

- Slackへの投稿内容をGASに投げる

- GASの処理結果をSlackに通知する

ということも可能です。

## 余談

この記事を書いているときに、スクリプトをAPIとして公開する方法もあることに気づきました。。。

こちらの方法も、いずれ、TILにまとめるかもしれません。

